import{u as J,r as u,b as P,m as F,c as G,a as H,e as a,w as l,h as r,y as w,f as m,o as Q,i as W,B as c,j as _,s as i,x as X,A as Y}from"./index-ZRmCAO4x.js";import{a as Z,u as ee,b as te,d as ae}from"./role-DbAJGpHy.js";import{a as le,b as ne,c as oe}from"./menu-Py2n_BOD.js";import{_ as se}from"./_plugin-vue_export-helper-DLdCVoit.js";import{S as ie,A as re,C as ue}from"./SearchSharp-DVD_wjTH.js";import{K as de}from"./KeySharp-g5NpzAuK.js";import{T as ce}from"./TrashSharp-J88QsNrE.js";const pe={class:"role-list"},fe={class:"toolbar"},me={__name:"RoleList",setup(ve){const d=J(),b=u(!1),y=u(!1),g=u(!1),v=u(null),x=u(null),R=u(null),C=u(""),M=u([]),U=u([]),h=u([]),p=P({page:1,pageSize:10,itemCount:0,showSizePicker:!0,pageSizes:[10,20,50]}),n=P({name:"",code:"",description:""}),I={name:{required:!0,message:"请输入角色名称",trigger:"blur"},code:{required:!0,message:"请输入角色编码",trigger:"blur"}},K=[{title:"ID",key:"id",width:80},{title:"角色名称",key:"name"},{title:"角色编码",key:"code",render:t=>i(X,{type:"info"},{default:()=>t.code})},{title:"描述",key:"description"},{title:"操作",key:"actions",width:240,render:t=>{const e=["ADMIN","PROJECT_ADMIN","DEVELOPER","USER"].includes(t.code),s=[i(c,{text:!0,type:"primary",onClick:()=>N(t)},{default:()=>"编辑",icon:()=>i("i",{class:"n-icon"},[i(ue)])}),i(c,{text:!0,type:"warning",onClick:()=>V(t.id)},{default:()=>"菜单权限",icon:()=>i("i",{class:"n-icon"},[i(de)])})];return e||s.push(i(Y,{onPositiveClick:()=>E(t.id)},{default:()=>"确定删除此角色吗？",trigger:()=>i(c,{text:!0,type:"error"},{default:()=>"删除",icon:()=>i("i",{class:"n-icon"},[i(ce)])})})),i(w,null,{default:()=>s})}}],f=async()=>{b.value=!0;try{const t=await Z({current:p.page,size:p.pageSize,name:C.value});M.value=t.records,p.itemCount=t.total}catch{d.error("加载失败")}finally{b.value=!1}},N=(t=null)=>{v.value=t?t.id:null,t?(n.name=t.name,n.code=t.code,n.description=t.description||""):(n.name="",n.code="",n.description=""),y.value=!0},D=()=>{var t;(t=R.value)==null||t.validate(async e=>{if(!e)try{const s={...n};v.value?(s.id=v.value,await ee(s),d.success("更新成功")):(await te(s),d.success("添加成功")),y.value=!1,f()}catch{d.error(v.value?"更新失败":"添加失败")}})},E=async t=>{try{await ae(t),d.success("删除成功"),f()}catch{d.error("删除失败")}},A=t=>{p.page=t,f()},B=t=>{p.pageSize=t,p.page=1,f()},V=async t=>{x.value=t;try{const e=await ne();U.value=T(e);const s=await oe(t);h.value=s,g.value=!0}catch{d.error("加载菜单权限失败")}},T=t=>t.map(e=>({key:e.id,label:e.name,children:e.children?T(e.children):void 0})),L=t=>{h.value=t},O=async()=>{try{await le(x.value,h.value),d.success("保存成功"),g.value=!1}catch{d.error("保存失败")}};return F(()=>{f()}),(t,e)=>{const s=m("n-icon"),k=m("n-input"),$=m("n-data-table"),S=m("n-form-item"),q=m("n-form"),z=m("n-modal"),j=m("n-tree");return Q(),G("div",pe,[H("div",fe,[a(r(w),null,{default:l(()=>[a(k,{value:C.value,"onUpdate:value":e[0]||(e[0]=o=>C.value=o),placeholder:"搜索角色名称",clearable:"",style:{width:"250px"},onKeyup:W(f,["enter"])},{suffix:l(()=>[a(r(c),{text:"",onClick:f},{default:l(()=>[a(s,null,{default:l(()=>[a(r(ie))]),_:1})]),_:1})]),_:1},8,["value"]),a(r(c),{type:"primary",onClick:e[1]||(e[1]=o=>N())},{icon:l(()=>[a(s,null,{default:l(()=>[a(r(re))]),_:1})]),default:l(()=>[e[9]||(e[9]=_(" 新增角色 ",-1))]),_:1})]),_:1})]),a($,{columns:K,data:M.value,pagination:p,loading:b.value,remote:!0,"onUpdate:page":A,"onUpdate:pageSize":B},null,8,["data","pagination","loading"]),a(z,{show:y.value,"onUpdate:show":e[6]||(e[6]=o=>y.value=o),title:v.value?"编辑角色":"新增角色",preset:"dialog",style:{width:"500px"},"show-icon":!1},{action:l(()=>[a(r(w),null,{default:l(()=>[a(r(c),{onClick:e[5]||(e[5]=o=>y.value=!1)},{default:l(()=>[...e[10]||(e[10]=[_("取消",-1)])]),_:1}),a(r(c),{type:"primary",onClick:D},{default:l(()=>[...e[11]||(e[11]=[_("确定",-1)])]),_:1})]),_:1})]),default:l(()=>[a(q,{ref_key:"formRef",ref:R,model:n,rules:I,"label-placement":"left","label-width":"100"},{default:l(()=>[a(S,{label:"角色名称",path:"name"},{default:l(()=>[a(k,{value:n.name,"onUpdate:value":e[2]||(e[2]=o=>n.name=o)},null,8,["value"])]),_:1}),a(S,{label:"角色编码",path:"code"},{default:l(()=>[a(k,{value:n.code,"onUpdate:value":e[3]||(e[3]=o=>n.code=o),disabled:!!v.value},null,8,["value","disabled"])]),_:1}),a(S,{label:"描述",path:"description"},{default:l(()=>[a(k,{value:n.description,"onUpdate:value":e[4]||(e[4]=o=>n.description=o),type:"textarea",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"]),a(z,{show:g.value,"onUpdate:show":e[8]||(e[8]=o=>g.value=o),title:"菜单权限设置",preset:"dialog",style:{width:"500px"},"show-icon":!1},{action:l(()=>[a(r(w),null,{default:l(()=>[a(r(c),{onClick:e[7]||(e[7]=o=>g.value=!1)},{default:l(()=>[...e[12]||(e[12]=[_("取消",-1)])]),_:1}),a(r(c),{type:"primary",onClick:O},{default:l(()=>[...e[13]||(e[13]=[_("保存",-1)])]),_:1})]),_:1})]),default:l(()=>[a(j,{"block-line":"",checkable:"",data:U.value,"checked-keys":h.value,"onUpdate:checkedKeys":L},null,8,["data","checked-keys"])]),_:1},8,["show"])])}}},Ce=se(me,[["__scopeId","data-v-58c9ef47"]]);export{Ce as default};
