import{g as S,c as E,e as K}from"./user-UVrBmC5g.js";import{_ as L}from"./_plugin-vue_export-helper-BD_vjw2A.js";import{d as j,c as F,o as R,a as D,u as H,r as p,b as U,m as J,e as a,w as o,f as t,j as c,h as f}from"./index-BnxR2ysJ.js";import{R as C}from"./RefreshSharp-B_6ZdOyC.js";import{K as O}from"./KeySharp-BemfhZ6u.js";const $={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},A=D("path",{d:"M380.44 32H64a32 32 0 0 0-32 32v384a32 32 0 0 0 32 32h384a32.09 32.09 0 0 0 32-32V131.56zM112 176v-64h192v64zm223.91 179.76a80 80 0 1 1-83.66-83.67a80.21 80.21 0 0 1 83.66 83.67z",fill:"currentColor"},null,-1),G=[A],Q=j({name:"SaveSharp",render:function(w,_){return R(),F("svg",$,G)}}),W={class:"profile"},X={__name:"Profile",setup(I){const w=H(),_=p(),P=p(),g=p(!1),v=p(!1),l=U({username:"",nickname:"",email:""}),s=U({oldPassword:"",newPassword:"",confirmPassword:""}),q=(r,e)=>e!==s.newPassword?new Error("两次输入的密码不一致"):!0,B={nickname:{required:!0,message:"请输入昵称",trigger:"blur"},email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}]},M={oldPassword:{required:!0,message:"请输入原密码",trigger:"blur"},newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码至少6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:q,message:"两次输入的密码不一致",trigger:"blur"}]},b=async()=>{try{const r=await S();console.log("loadUserInfo",r),l.username=r.user.username||"",l.nickname=r.user.nickname||"",l.email=r.user.email||""}catch(r){console.error(r)}},N=async()=>{var r;try{await((r=_.value)==null?void 0:r.validate()),g.value=!0,await E({nickname:l.nickname,email:l.email}),w.success("个人信息更新成功");const e=await S();localStorage.setItem("user",JSON.stringify(e)),setTimeout(()=>{window.location.reload()},500)}catch(e){if(e!=null&&e.errorFields)return;console.error(e)}finally{g.value=!1}},V=async()=>{var r;try{await((r=P.value)==null?void 0:r.validate()),v.value=!0,await K({oldPassword:s.oldPassword,newPassword:s.newPassword}),w.success("密码修改成功，请重新登录"),k(),setTimeout(()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"},1500)}catch(e){if(e!=null&&e.errorFields)return;console.error(e)}finally{v.value=!1}},k=()=>{s.oldPassword="",s.newPassword="",s.confirmPassword=""};return J(()=>{b()}),(r,e)=>{const i=t("n-input"),d=t("n-form-item"),u=t("n-icon"),m=t("n-button"),y=t("n-space"),h=t("n-form"),x=t("n-tab-pane"),z=t("n-tabs"),T=t("n-card");return R(),F("div",W,[a(T,{title:"个人信息",bordered:!1},{default:o(()=>[a(z,{type:"line",animated:""},{default:o(()=>[a(x,{name:"basic",tab:"基本信息"},{default:o(()=>[a(h,{ref_key:"profileFormRef",ref:_,model:l,rules:B,"label-placement":"left","label-width":"100",style:{"max-width":"600px","margin-top":"24px"}},{default:o(()=>[a(d,{label:"用户名",path:"username"},{default:o(()=>[a(i,{value:l.username,"onUpdate:value":e[0]||(e[0]=n=>l.username=n),disabled:""},null,8,["value"])]),_:1}),a(d,{label:"昵称",path:"nickname"},{default:o(()=>[a(i,{value:l.nickname,"onUpdate:value":e[1]||(e[1]=n=>l.nickname=n),placeholder:"请输入昵称"},null,8,["value"])]),_:1}),a(d,{label:"邮箱",path:"email"},{default:o(()=>[a(i,{value:l.email,"onUpdate:value":e[2]||(e[2]=n=>l.email=n),placeholder:"请输入邮箱"},null,8,["value"])]),_:1}),a(d,null,{default:o(()=>[a(y,null,{default:o(()=>[a(m,{type:"primary",onClick:N,loading:g.value},{icon:o(()=>[a(u,null,{default:o(()=>[a(f(Q))]),_:1})]),default:o(()=>[e[6]||(e[6]=c(" 保存修改 ",-1))]),_:1},8,["loading"]),a(m,{onClick:b},{icon:o(()=>[a(u,null,{default:o(()=>[a(f(C))]),_:1})]),default:o(()=>[e[7]||(e[7]=c(" 重置 ",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(x,{name:"password",tab:"修改密码"},{default:o(()=>[a(h,{ref_key:"passwordFormRef",ref:P,model:s,rules:M,"label-placement":"left","label-width":"100",style:{"max-width":"600px","margin-top":"24px"}},{default:o(()=>[a(d,{label:"原密码",path:"oldPassword"},{default:o(()=>[a(i,{value:s.oldPassword,"onUpdate:value":e[3]||(e[3]=n=>s.oldPassword=n),type:"password","show-password-on":"click",placeholder:"请输入原密码"},null,8,["value"])]),_:1}),a(d,{label:"新密码",path:"newPassword"},{default:o(()=>[a(i,{value:s.newPassword,"onUpdate:value":e[4]||(e[4]=n=>s.newPassword=n),type:"password","show-password-on":"click",placeholder:"请输入新密码（至少6位）"},null,8,["value"])]),_:1}),a(d,{label:"确认密码",path:"confirmPassword"},{default:o(()=>[a(i,{value:s.confirmPassword,"onUpdate:value":e[5]||(e[5]=n=>s.confirmPassword=n),type:"password","show-password-on":"click",placeholder:"请再次输入新密码"},null,8,["value"])]),_:1}),a(d,null,{default:o(()=>[a(y,null,{default:o(()=>[a(m,{type:"primary",onClick:V,loading:v.value},{icon:o(()=>[a(u,null,{default:o(()=>[a(f(O))]),_:1})]),default:o(()=>[e[8]||(e[8]=c(" 修改密码 ",-1))]),_:1},8,["loading"]),a(m,{onClick:k},{icon:o(()=>[a(u,null,{default:o(()=>[a(f(C))]),_:1})]),default:o(()=>[e[9]||(e[9]=c(" 重置 ",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})])}}},re=L(X,[["__scopeId","data-v-588e5614"]]);export{re as default};
