import{u as $,r as c,b as I,m as j,c as E,a as F,e as l,w as s,h as r,y as h,f as u,o as G,i as H,B as _,j as k,s as o,x as N,A as J}from"./index-ZRmCAO4x.js";import{a as Q,u as W,b as X,d as Y}from"./user-B4dTOeaI.js";import{g as Z}from"./role-DbAJGpHy.js";import{_ as ee}from"./_plugin-vue_export-helper-DLdCVoit.js";import{S as ae,A as te,C as le}from"./SearchSharp-DVD_wjTH.js";import{T as se}from"./TrashSharp-J88QsNrE.js";const ne={class:"user-list"},oe={class:"toolbar"},ue={__name:"UserList",setup(re){const i=$(),w=c(!1),y=c(!1),d=c(null),U=c(null),b=c(""),S=c([]),C=c([]),p=I({page:1,pageSize:10,itemCount:0,showSizePicker:!0,pageSizes:[10,20,50]}),t=I({username:"",password:"",nickname:"",email:"",phone:"",status:1,roleIds:[]}),B={username:{required:!0,message:"请输入用户名",trigger:"blur"},nickname:{required:!0,message:"请输入昵称",trigger:"blur"}},P=[{title:"ID",key:"id",width:80},{title:"用户名",key:"username"},{title:"昵称",key:"nickname"},{title:"邮箱",key:"email"},{title:"电话",key:"phone"},{title:"状态",key:"status",render:a=>o(N,{type:a.status===1?"success":"error"},{default:()=>a.status===1?"启用":"禁用"})},{title:"角色",key:"roles",render:a=>!a.roles||a.roles.length===0?"-":o(h,null,{default:()=>a.roles.map(e=>o(N,{type:"info",size:"small"},{default:()=>e.name}))})},{title:"操作",key:"actions",width:180,render:a=>o(h,null,{default:()=>[o(_,{text:!0,type:"primary",onClick:()=>x(a)},{default:()=>"编辑",icon:()=>o("i",{class:"n-icon"},[o(le)])}),o(J,{onPositiveClick:()=>T(a.id)},{default:()=>"确定删除此用户吗？",trigger:()=>o(_,{text:!0,type:"error"},{default:()=>"删除",icon:()=>o("i",{class:"n-icon"},[o(se)])})})]})}],m=async()=>{w.value=!0;try{const a=await Q({current:p.page,size:p.pageSize,username:b.value});S.value=a.records,p.itemCount=a.total}catch{i.error("加载失败")}finally{w.value=!1}},A=async()=>{try{const a=await Z();C.value=a.map(e=>({label:e.name,value:e.id}))}catch{i.error("加载角色失败")}},x=(a=null)=>{d.value=a?a.id:null,a?(t.username=a.username,t.password="",t.nickname=a.nickname,t.email=a.email||"",t.phone=a.phone||"",t.status=a.status,t.roleIds=a.roles?a.roles.map(e=>e.id):[]):(t.username="",t.password="",t.nickname="",t.email="",t.phone="",t.status=1,t.roleIds=[]),y.value=!0},R=()=>{var a;(a=U.value)==null||a.validate(async e=>{if(!e)try{const f={...t};d.value?(f.id=d.value,await W(f),i.success("更新成功")):(await X(f),i.success("添加成功")),y.value=!1,m()}catch{i.error(d.value?"更新失败":"添加失败")}})},T=async a=>{try{await Y(a),i.success("删除成功"),m()}catch{i.error("删除失败")}},D=a=>{p.page=a,m()},L=a=>{p.pageSize=a,p.page=1,m()};return j(()=>{m(),A()}),(a,e)=>{const f=u("n-icon"),g=u("n-input"),M=u("n-data-table"),v=u("n-form-item"),z=u("n-radio"),V=u("n-radio-group"),q=u("n-select"),K=u("n-form"),O=u("n-modal");return G(),E("div",ne,[F("div",oe,[l(r(h),null,{default:s(()=>[l(g,{value:b.value,"onUpdate:value":e[0]||(e[0]=n=>b.value=n),placeholder:"搜索用户名",clearable:"",style:{width:"250px"},onKeyup:H(m,["enter"])},{suffix:s(()=>[l(r(_),{text:"",onClick:m},{default:s(()=>[l(f,null,{default:s(()=>[l(r(ae))]),_:1})]),_:1})]),_:1},8,["value"]),l(r(_),{type:"primary",onClick:e[1]||(e[1]=n=>x())},{icon:s(()=>[l(f,null,{default:s(()=>[l(r(te))]),_:1})]),default:s(()=>[e[11]||(e[11]=k(" 新增用户 ",-1))]),_:1})]),_:1})]),l(M,{columns:P,data:S.value,pagination:p,loading:w.value,remote:!0,"onUpdate:page":D,"onUpdate:pageSize":L},null,8,["data","pagination","loading"]),l(O,{show:y.value,"onUpdate:show":e[10]||(e[10]=n=>y.value=n),title:d.value?"编辑用户":"新增用户",preset:"dialog",style:{width:"600px"},"show-icon":!1},{action:s(()=>[l(r(h),null,{default:s(()=>[l(r(_),{onClick:e[9]||(e[9]=n=>y.value=!1)},{default:s(()=>[...e[14]||(e[14]=[k("取消",-1)])]),_:1}),l(r(_),{type:"primary",onClick:R},{default:s(()=>[...e[15]||(e[15]=[k("确定",-1)])]),_:1})]),_:1})]),default:s(()=>[l(K,{ref_key:"formRef",ref:U,model:t,rules:B,"label-placement":"left","label-width":"100"},{default:s(()=>[l(v,{label:"用户名",path:"username"},{default:s(()=>[l(g,{value:t.username,"onUpdate:value":e[2]||(e[2]=n=>t.username=n),disabled:!!d.value},null,8,["value","disabled"])]),_:1}),l(v,{label:"密码",path:"password"},{default:s(()=>[l(g,{value:t.password,"onUpdate:value":e[3]||(e[3]=n=>t.password=n),type:"password","show-password-on":"click",placeholder:d.value?"不修改请留空":"默认密码123456"},null,8,["value","placeholder"])]),_:1}),l(v,{label:"昵称",path:"nickname"},{default:s(()=>[l(g,{value:t.nickname,"onUpdate:value":e[4]||(e[4]=n=>t.nickname=n)},null,8,["value"])]),_:1}),l(v,{label:"邮箱",path:"email"},{default:s(()=>[l(g,{value:t.email,"onUpdate:value":e[5]||(e[5]=n=>t.email=n)},null,8,["value"])]),_:1}),l(v,{label:"电话",path:"phone"},{default:s(()=>[l(g,{value:t.phone,"onUpdate:value":e[6]||(e[6]=n=>t.phone=n)},null,8,["value"])]),_:1}),l(v,{label:"状态",path:"status"},{default:s(()=>[l(V,{value:t.status,"onUpdate:value":e[7]||(e[7]=n=>t.status=n)},{default:s(()=>[l(z,{value:1},{default:s(()=>[...e[12]||(e[12]=[k("启用",-1)])]),_:1}),l(z,{value:0},{default:s(()=>[...e[13]||(e[13]=[k("禁用",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),l(v,{label:"角色",path:"roleIds"},{default:s(()=>[l(q,{value:t.roleIds,"onUpdate:value":e[8]||(e[8]=n=>t.roleIds=n),options:C.value,multiple:"",placeholder:"请选择角色"},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])])}}},ce=ee(ue,[["__scopeId","data-v-6da6ad2c"]]);export{ce as default};
