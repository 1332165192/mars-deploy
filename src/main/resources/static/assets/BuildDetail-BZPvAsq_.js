import{r as f,m as h,p as C,c as R,e as o,w as e,f as l,n as E,D as T,g as U,o as W,j as a,v as r,h as G,a as g}from"./index-BnxR2ysJ.js";import{e as V}from"./build-CChsEOUW.js";import{_ as $}from"./_plugin-vue_export-helper-BD_vjw2A.js";import{R as j}from"./RefreshSharp-B_6ZdOyC.js";const A={class:"build-detail"},F={__name:"BuildDetail",setup(L){const v=U(),d=E(),n=f({}),_=f(""),p=f();let c=null;const b=t=>({PENDING:"default",RUNNING:"info",SUCCESS:"success",FAILED:"error"})[t]||"default",S=t=>({PENDING:"等待中",RUNNING:"运行中",SUCCESS:"成功",FAILED:"失败"})[t]||t,N=()=>{v.back()},m=async()=>{if(!d.params.id){console.error("构建ID不存在");return}try{const t=await V(d.params.id);n.value=t,t.log&&(_.value=t.log)}catch(t){console.error(t)}},k=()=>{if(!d.params.id){console.error("构建ID不存在，无法建立WebSocket连接");return}const s=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws/build/${d.params.id}`;c=new WebSocket(s),c.onopen=()=>{console.log("WebSocket连接已建立")},c.onmessage=i=>{_.value+=i.data+`
`,T(()=>{p.value&&(p.value.scrollTop=p.value.scrollHeight)})},c.onerror=i=>{console.error("WebSocket错误:",i)},c.onclose=()=>{console.log("WebSocket连接已关闭"),m()}};return h(()=>{m(),k()}),C(()=>{c&&c.close()}),(t,s)=>{const i=l("n-tag"),w=l("n-icon"),D=l("n-button"),I=l("n-space"),u=l("n-descriptions-item"),x=l("n-descriptions"),y=l("n-page-header"),B=l("n-card");return W(),R("div",A,[o(y,{onBack:N},{title:e(()=>[...s[0]||(s[0]=[a("构建详情",-1)])]),extra:e(()=>[o(I,null,{default:e(()=>[o(i,{type:b(n.value.status)},{default:e(()=>[a(r(S(n.value.status)),1)]),_:1},8,["type"]),o(D,{onClick:m},{icon:e(()=>[o(w,null,{default:e(()=>[o(G(j))]),_:1})]),default:e(()=>[s[1]||(s[1]=a(" 刷新 ",-1))]),_:1})]),_:1})]),default:e(()=>[o(x,{column:3,bordered:"",style:{"margin-top":"16px"}},{default:e(()=>[o(u,{label:"构建ID"},{default:e(()=>[a(r(n.value.id),1)]),_:1}),o(u,{label:"项目名称"},{default:e(()=>[a(r(n.value.projectName||"-"),1)]),_:1}),o(u,{label:"触发人"},{default:e(()=>[a(r(n.value.triggerByName||"-"),1)]),_:1}),o(u,{label:"开始时间"},{default:e(()=>[a(r(n.value.startTime||"-"),1)]),_:1}),o(u,{label:"结束时间"},{default:e(()=>[a(r(n.value.endTime||"-"),1)]),_:1}),o(u,{label:"耗时"},{default:e(()=>[a(r(n.value.duration?n.value.duration+"s":"-"),1)]),_:1})]),_:1})]),_:1}),o(B,{title:"构建日志",style:{"margin-top":"16px"},bordered:!1},{default:e(()=>[g("div",{class:"log-console",ref_key:"logConsoleRef",ref:p},[g("pre",null,r(_.value),1)],512)]),_:1})])}}},z=$(F,[["__scopeId","data-v-38447cf9"]]);export{z as default};
