import{d as G,c as z,o as A,a as $,u as H,r as d,b as J,m as Q,e as l,w as n,h as p,y as C,f as i,i as W,B as f,j as c,s,x as X,A as Y}from"./index-ZRmCAO4x.js";import{b as E,u as Z,d as ee,e as te}from"./menu-Py2n_BOD.js";import{_ as le}from"./_plugin-vue_export-helper-DLdCVoit.js";import{S as ae,A as ne,C as oe}from"./SearchSharp-DVD_wjTH.js";import{T as se}from"./TrashSharp-J88QsNrE.js";const re={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ue=$("path",{d:"M256 48C141.31 48 48 141.31 48 256s93.31 208 208 208s208-93.31 208-208S370.69 48 256 48zm96 224h-80v80h-32v-80h-80v-32h80v-80h32v80h80z",fill:"currentColor"},null,-1),ie=[ue],de=G({name:"AddCircleSharp",render:function(m,w){return A(),z("svg",re,ie)}}),pe={class:"menu-list"},me={class:"toolbar"},ve={__name:"MenuList",setup(D){const m=H(),w=d(!1),_=d(!1),h=d(null),U=d(null),b=d(""),g=d([]),S=d([]),N=d([]),a=J({parentId:0,name:"",path:"",icon:"",sortOrder:0,menuType:"MENU",visible:1}),V={name:{required:!0,message:"请输入菜单名称",trigger:"blur"}},K=[{title:"ID",key:"id",width:80},{title:"菜单名称",key:"name",width:200},{title:"路径",key:"path",width:200},{title:"图标",key:"icon",width:150},{title:"排序",key:"sortOrder",width:80},{title:"类型",key:"menuType",width:100,render:t=>s(X,{type:t.menuType==="MENU"?"info":"warning",size:"small"},{default:()=>t.menuType==="MENU"?"菜单":"按钮"})},{title:"操作",key:"actions",width:280,render:t=>s(C,null,{default:()=>[s(f,{text:!0,type:"success",size:"small",onClick:()=>M(null,t.id)},{default:()=>"新增子菜单",icon:()=>s("i",{class:"n-icon"},[s(de)])}),s(f,{text:!0,type:"primary",size:"small",onClick:()=>M(t)},{default:()=>"编辑",icon:()=>s("i",{class:"n-icon"},[s(oe)])}),s(Y,{onPositiveClick:()=>P(t.id)},{default:()=>"确定删除此菜单吗？",trigger:()=>s(f,{text:!0,type:"error",size:"small"},{default:()=>"删除",icon:()=>s("i",{class:"n-icon"},[s(se)])})})]})}],y=async()=>{w.value=!0;try{const t=await E();b.value?g.value=O(t,b.value):g.value=t,S.value=t}catch{m.error("加载失败")}finally{w.value=!1}},O=(t,e)=>{const r=[];for(const u of t)if(u.name.includes(e))r.push(u);else if(u.children&&u.children.length>0){const k=O(u.children,e);k.length>0&&r.push({...u,children:k})}return r},x=async()=>{try{const t=await E();S.value=t,N.value=I(t)}catch(t){console.error(t)}},I=t=>[{label:"顶级菜单",key:0,value:0},...t.map(e=>({label:e.name,key:e.id,value:e.id,children:e.children?I(e.children):void 0}))],M=(t=null,e=null)=>{h.value=t?t.id:null,t?(a.parentId=t.parentId,a.name=t.name,a.path=t.path||"",a.icon=t.icon||"",a.sortOrder=t.sortOrder||0,a.menuType=t.menuType||"MENU",a.visible=t.visible||1):(a.parentId=e||0,a.name="",a.path="",a.icon="",a.sortOrder=0,a.menuType="MENU",a.visible=1),_.value=!0},L=()=>{var t;(t=U.value)==null||t.validate(async e=>{if(!e)try{const r={...a};h.value?(r.id=h.value,await Z(r),m.success("更新成功")):(await ee(r),m.success("添加成功")),_.value=!1,y(),x()}catch{m.error(h.value?"更新失败":"添加失败")}})},P=async t=>{try{await te(t),m.success("删除成功"),y(),x()}catch{m.error("删除失败")}};return Q(()=>{y(),x()}),(t,e)=>{const r=i("n-icon"),u=i("n-input"),k=i("n-data-table"),R=i("n-tree-select"),v=i("n-form-item"),j=i("n-input-number"),T=i("n-radio"),B=i("n-radio-group"),q=i("n-form"),F=i("n-modal");return A(),z("div",pe,[$("div",me,[l(p(C),null,{default:n(()=>[l(u,{value:b.value,"onUpdate:value":e[0]||(e[0]=o=>b.value=o),placeholder:"搜索菜单名称",clearable:"",style:{width:"250px"},onKeyup:W(y,["enter"])},{suffix:n(()=>[l(p(f),{text:"",onClick:y},{default:n(()=>[l(r,null,{default:n(()=>[l(p(ae))]),_:1})]),_:1})]),_:1},8,["value"]),l(p(f),{type:"primary",onClick:e[1]||(e[1]=o=>M())},{icon:n(()=>[l(r,null,{default:n(()=>[l(p(ne))]),_:1})]),default:n(()=>[e[11]||(e[11]=c(" 新增菜单 ",-1))]),_:1})]),_:1})]),l(k,{columns:K,data:g.value,loading:w.value,"default-expand-all":"","row-key":o=>o.id},null,8,["data","loading","row-key"]),l(F,{show:_.value,"onUpdate:show":e[10]||(e[10]=o=>_.value=o),title:h.value?"编辑菜单":"新增菜单",preset:"dialog",style:{width:"600px"},"show-icon":!1},{action:n(()=>[l(p(C),null,{default:n(()=>[l(p(f),{onClick:e[9]||(e[9]=o=>_.value=!1)},{default:n(()=>[...e[16]||(e[16]=[c("取消",-1)])]),_:1}),l(p(f),{type:"primary",onClick:L},{default:n(()=>[...e[17]||(e[17]=[c("确定",-1)])]),_:1})]),_:1})]),default:n(()=>[l(q,{ref_key:"formRef",ref:U,model:a,rules:V,"label-placement":"left","label-width":"100"},{default:n(()=>[l(v,{label:"父菜单",path:"parentId"},{default:n(()=>[l(R,{value:a.parentId,"onUpdate:value":e[2]||(e[2]=o=>a.parentId=o),options:N.value,clearable:"",placeholder:"顶级菜单"},null,8,["value","options"])]),_:1}),l(v,{label:"菜单名称",path:"name"},{default:n(()=>[l(u,{value:a.name,"onUpdate:value":e[3]||(e[3]=o=>a.name=o)},null,8,["value"])]),_:1}),l(v,{label:"菜单路径",path:"path"},{default:n(()=>[l(u,{value:a.path,"onUpdate:value":e[4]||(e[4]=o=>a.path=o),placeholder:"/path"},null,8,["value"])]),_:1}),l(v,{label:"图标",path:"icon"},{default:n(()=>[l(u,{value:a.icon,"onUpdate:value":e[5]||(e[5]=o=>a.icon=o),placeholder:"SpeedometerSharp"},null,8,["value"])]),_:1}),l(v,{label:"排序",path:"sortOrder"},{default:n(()=>[l(j,{value:a.sortOrder,"onUpdate:value":e[6]||(e[6]=o=>a.sortOrder=o),min:0,style:{width:"100%"}},null,8,["value"])]),_:1}),l(v,{label:"菜单类型",path:"menuType"},{default:n(()=>[l(B,{value:a.menuType,"onUpdate:value":e[7]||(e[7]=o=>a.menuType=o)},{default:n(()=>[l(T,{value:"MENU"},{default:n(()=>[...e[12]||(e[12]=[c("菜单",-1)])]),_:1}),l(T,{value:"BUTTON"},{default:n(()=>[...e[13]||(e[13]=[c("按钮",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),l(v,{label:"是否可见",path:"visible"},{default:n(()=>[l(B,{value:a.visible,"onUpdate:value":e[8]||(e[8]=o=>a.visible=o)},{default:n(()=>[l(T,{value:1},{default:n(()=>[...e[14]||(e[14]=[c("是",-1)])]),_:1}),l(T,{value:0},{default:n(()=>[...e[15]||(e[15]=[c("否",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])])}}},we=le(ve,[["__scopeId","data-v-4bce31bf"]]);export{we as default};
