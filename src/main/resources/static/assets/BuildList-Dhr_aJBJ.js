import{d as L,c as S,o as z,a as p,u as R,r as l,b as $,m as G,n as M,e as s,w as c,h as f,y as w,f as u,g as A,B as _,j as V,s as o,x as F,A as O}from"./index-ZRmCAO4x.js";import{a as q,d as H}from"./build-Csp7udDc.js";import{g as J}from"./project-DCaa_oZL.js";import{_ as K}from"./_plugin-vue_export-helper-DLdCVoit.js";import{R as Q}from"./RefreshSharp-BJZeGQ5E.js";import{T as W}from"./TrashSharp-J88QsNrE.js";const X={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Y=p("circle",{cx:"256",cy:"256",r:"64",fill:"currentColor"},null,-1),Z=p("path",{d:"M394.82 141.18C351.1 111.2 304.31 96 255.76 96c-43.69 0-86.28 13-126.59 38.48C88.52 160.23 48.67 207 16 256c26.42 44 62.56 89.24 100.2 115.18C159.38 400.92 206.33 416 255.76 416c49 0 95.85-15.07 139.3-44.79C433.31 345 469.71 299.82 496 256c-26.38-43.43-62.9-88.56-101.18-114.82zM256 352a96 96 0 1 1 96-96a96.11 96.11 0 0 1-96 96z",fill:"currentColor"},null,-1),ee=[Y,Z],te=L({name:"EyeSharp",render:function(h,d){return z(),S("svg",X,ee)}}),ae={class:"build-list"},oe={class:"toolbar"},se={class:"pagination-wrapper"},ne={__name:"BuildList",setup(C){const h=A(),d=M(),g=R(),m=l(!1),r=l(null),v=l([]),y=l([]),a=$({page:1,pageSize:10,itemCount:0,showSizePicker:!0,pageSizes:[10,20,50]}),N=[{title:"ID",key:"id",width:80},{title:"项目名称",key:"projectName",width:150},{title:"状态",key:"status",width:100,render:e=>o(F,{type:k(e.status),size:"small"},{default:()=>x(e.status)})},{title:"触发人",key:"triggerByName",width:120},{title:"开始时间",key:"startTime",width:180},{title:"结束时间",key:"endTime",width:180},{title:"耗时",key:"duration",width:100,render:e=>e.duration?`${e.duration}s`:"-"},{title:"操作",key:"action",width:200,render:e=>o(w,{},{default:()=>[o(_,{text:!0,type:"primary",size:"small",onClick:()=>P(e.id)},{default:()=>"查看详情",icon:()=>o("i",{class:"n-icon"},[o(te)])}),o(O,{onPositiveClick:()=>b(e.id)},{default:()=>"确定要删除吗？",trigger:()=>o(_,{text:!0,type:"error",size:"small"},{default:()=>"删除",icon:()=>o("i",{class:"n-icon"},[o(W)])})})]})}],k=e=>({PENDING:"default",RUNNING:"info",SUCCESS:"success",FAILED:"error"})[e]||"default",x=e=>({PENDING:"等待中",RUNNING:"运行中",SUCCESS:"成功",FAILED:"失败"})[e]||e,n=async()=>{try{m.value=!0;const e={current:a.page,size:a.pageSize};r.value&&(e.projectId=r.value);const t=await q(e);v.value=t.records,a.itemCount=t.total}catch(e){console.error(e)}finally{m.value=!1}},I=async()=>{try{const e=await J({current:1,size:100});y.value=e.records.map(t=>({label:t.name,value:t.id}))}catch(e){console.error(e)}},B=e=>{a.page=e,n()},D=e=>{a.pageSize=e,a.page=1,n()},P=e=>{if(!e){g.error("构建ID不存在");return}h.push(`/build-detail/${e}`)},b=async e=>{if(!e){g.error("构建ID不存在");return}try{await H(e),g.success("删除成功"),n()}catch(t){console.error(t)}};return G(()=>{d.params.projectId&&(r.value=parseInt(d.params.projectId)),I(),n()}),(e,t)=>{const E=u("n-select"),j=u("n-icon"),T=u("n-data-table"),U=u("n-pagination");return z(),S("div",ae,[p("div",oe,[s(f(w),null,{default:c(()=>[s(E,{value:r.value,"onUpdate:value":[t[0]||(t[0]=i=>r.value=i),n],placeholder:"选择项目",style:{width:"200px"},clearable:"",options:y.value},null,8,["value","options"]),s(f(_),{onClick:n},{icon:c(()=>[s(j,null,{default:c(()=>[s(f(Q))]),_:1})]),default:c(()=>[t[3]||(t[3]=V(" 刷新 ",-1))]),_:1})]),_:1})]),s(T,{columns:N,data:v.value,loading:m.value,pagination:!1},null,8,["data","loading"]),p("div",se,[s(U,{page:a.page,"onUpdate:page":t[1]||(t[1]=i=>a.page=i),"page-size":a.pageSize,"onUpdate:pageSize":t[2]||(t[2]=i=>a.pageSize=i),"item-count":a.itemCount,"page-sizes":a.pageSizes,"show-size-picker":"","on-update:page":B,"on-update:page-size":D},null,8,["page","page-size","item-count","page-sizes"])])])}}},de=K(ne,[["__scopeId","data-v-b3258564"]]);export{de as default};
